export const DEFAULT_TICKER_BLACKLIST = new Set([
  "CEO",
  "CFO",
  "COO",
  "CTO",
  "IPO",
  "EPS",
  "GDP",
  "SEC",
  "FDA",
  "USA",
  "USD",
  "ETF",
  "NYSE",
  "API",
  "ATH",
  "ATL",
  "IMO",
  "FOMO",
  "YOLO",
  "DD",
  "TA",
  "FA",
  "ROI",
  "PE",
  "PB",
  "PS",
  "EV",
  "DCF",
  "WSB",
  "RIP",
  "LOL",
  "OMG",
  "WTF",
  "FUD",
  "HODL",
  "APE",
  "MOASS",
  "DRS",
  "NFT",
  "DAO",
  "THE",
  "AND",
  "FOR",
  "ARE",
  "BUT",
  "NOT",
  "YOU",
  "ALL",
  "CAN",
  "HER",
  "WAS",
  "ONE",
  "OUR",
  "OUT",
  "DAY",
  "HAD",
  "HAS",
  "HIS",
  "HOW",
  "ITS",
  "LET",
  "MAY",
  "NEW",
  "NOW",
  "OLD",
  "SEE",
  "WAY",
  "WHO",
  "BOY",
  "DID",
  "GET",
  "HIM",
  "HIT",
  "LOW",
  "MAN",
  "RUN",
  "SAY",
  "SHE",
  "TOO",
  "USE",
  "DAD",
  "MOM",
  "GOT",
  "PUT",
  "SAW",
  "SAT",
  "SET",
  "SIT",
  "TRY",
  "THAT",
  "THIS",
  "WITH",
  "HAVE",
  "FROM",
  "THEY",
  "BEEN",
  "CALL",
  "WILL",
  "EACH",
  "MAKE",
  "LIKE",
  "TIME",
  "JUST",
  "KNOW",
  "TAKE",
  "COME",
  "MADE",
  "FIND",
  "MORE",
  "LONG",
  "HERE",
  "MANY",
  "SOME",
  "THAN",
  "THEM",
  "THEN",
  "ONLY",
  "OVER",
  "SUCH",
  "YEAR",
  "INTO",
  "MOST",
  "ALSO",
  "BACK",
  "GOOD",
  "WELL",
  "EVEN",
  "WANT",
  "GIVE",
  "MUCH",
  "WORK",
  "FIRST",
  "AFTER",
  "AS",
  "AT",
  "BE",
  "BY",
  "DO",
  "GO",
  "IF",
  "IN",
  "IS",
  "IT",
  "MY",
  "NO",
  "OF",
  "ON",
  "OR",
  "SO",
  "TO",
  "UP",
  "US",
  "WE",
  "AN",
  "AM",
  "AH",
  "OH",
  "OK",
  "HI",
  "YA",
  "YO",
  "BULL",
  "BEAR",
  "CALL",
  "PUTS",
  "HOLD",
  "SELL",
  "MOON",
  "PUMP",
  "DUMP",
  "BAGS",
  "TEND",
  "START",
  "ABOUT",
  "NAME",
  "NEXT",
  "PLAY",
  "LIVE",
  "GAME",
  "BEST",
  "LINK",
  "READ",
  "POST",
  "NEWS",
  "FREE",
  "LOOK",
  "HELP",
  "OPEN",
  "FULL",
  "VIEW",
  "REAL",
  "SEND",
  "HIGH",
  "DROP",
  "FAST",
  "SAFE",
  "RISK",
  "TURN",
  "PLAN",
  "DEAL",
  "MOVE",
  "HUGE",
  "EASY",
  "HARD",
  "LATE",
  "WAIT",
  "SOON",
  "STOP",
  "EXIT",
  "GAIN",
  "LOSS",
  "GROW",
  "FALL",
  "JUMP",
  "KEEP",
  "COPY",
  "EDIT",
  "SAVE",
  "NOTE",
  "TIPS",
  "IDEA",
  "PLUS",
  "ZERO",
  "SELF",
  "BOTH",
  "BETA",
  "TEST",
  "INFO",
  "DATA",
  "CASH",
  "WHAT",
  "WHEN",
  "WHERE",
  "WHY",
  "WATCH",
  "LOVE",
  "HATE",
  "TECH",
  "HOPE",
  "FEAR",
  "WEEK",
  "LAST",
  "PART",
  "SIDE",
  "STEP",
  "SURE",
  "TELL",
  "THINK",
  "TOLD",
  "TRUE",
  "TYPE",
  "UNIT",
  "USED",
  "VERY",
  "WENT",
  "WERE",
  "YEAH",
  "YOUR",
  "ELSE",
  "AWAY",
  "OTHER",
  "PRICE",
  "THEIR",
  "STILL",
  "CHEAP",
  "THESE",
  "LEAP",
  "EVERY",
  "SINCE",
  "BEING",
  "THOSE",
  "DOING",
  "COULD",
  "WOULD",
  "SHOULD",
  "MIGHT",
  "MUST",
  "SHALL",
]);

export function extractTickers(text: string, customBlacklist: string[] = []): string[] {
  const matches = new Set<string>();
  const customSet = new Set(customBlacklist.map((t) => t.toUpperCase()));
  const regex =
    /\$([A-Z]{1,5})\b|\b([A-Z]{2,5})\b(?=\s+(?:calls?|puts?|stock|shares?|moon|rocket|yolo|buy|sell|long|short))/gi;
  let match: RegExpExecArray | null;
  while ((match = regex.exec(text)) !== null) {
    const ticker = (match[1] || match[2] || "").toUpperCase();
    if (ticker.length >= 2 && ticker.length <= 5 && !DEFAULT_TICKER_BLACKLIST.has(ticker) && !customSet.has(ticker)) {
      matches.add(ticker);
    }
  }
  return Array.from(matches);
}

export function detectSentiment(text: string): number {
  const lower = text.toLowerCase();
  const bullish = [
    "moon",
    "rocket",
    "buy",
    "calls",
    "long",
    "bullish",
    "yolo",
    "tendies",
    "gains",
    "diamond",
    "squeeze",
    "pump",
    "green",
    "up",
    "breakout",
    "undervalued",
    "accumulate",
  ];
  const bearish = [
    "puts",
    "short",
    "sell",
    "bearish",
    "crash",
    "dump",
    "drill",
    "tank",
    "rip",
    "red",
    "down",
    "bag",
    "overvalued",
    "bubble",
    "avoid",
  ];
  let bull = 0;
  let bear = 0;
  for (const w of bullish) if (lower.includes(w)) bull++;
  for (const w of bearish) if (lower.includes(w)) bear++;
  const total = bull + bear;
  if (total === 0) return 0;
  return (bull - bear) / total;
}

